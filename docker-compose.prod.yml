services:
  postgres:
    ports: []
  bot:
    image: jdinbot:latest
    ports:
      - "8000:8000"
    environment:
      - ENV=production
    command: >
      /bin/sh -c "./docker/scripts/wait-for-it.sh ${POSTGRES_HOST}:${POSTGRES_PORT} --timeout=30 --strict -- uvicorn jdinbot.main:jdinbot --host 0.0.0.0 --port 8000 --workers 4"
    deploy:
      restart_policy:
        condition: on-failure